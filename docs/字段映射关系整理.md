# 字段映射关系整理

## 一、数据库表结构

### 1. IA_M_HSURFACE (横断面表)
| 字段名 | 类型 | 说明 | 主键/唯一键 |
|--------|------|------|------------|
| hecd | varchar(50) | 横断面编码 | PRI |
| aid | int(11) | - | |
| channel | varchar(20) | 河流名 | |
| address | varchar(255) | 地址/名称 | |
| isctown | int(11) | - | |
| dmidentit | varchar(20) | 断面标识 | |
| dmform | varchar(2) | 断面形态 | |
| texture | varchar(2) | 材质 | |
| coordinate | varchar(2) | 坐标系 | |
| eletype | varchar(2) | 高程类型 | |
| baseele | float | 基础高程 | |
| baselgtd | float | 基础经度 | |
| baselttd | float | 基础纬度 | |
| azimuth | float | 方位角 | |
| hmz | float | - | |
| czz | float | - | |
| method | varchar(2) | 方法 | |
| adcd | varchar(255) | **防治对象代码** | |
| status | varchar(255) | 状态 | |
| moditime | datetime | 修改时间 | |
| wscd | varchar(25) | - | |
| folder_name | varchar(255) | 文件夹名称 | UNI |
| coeff | double | 系数 | |
| vecd | varchar(25) | **关联的纵断面编码** | |
| number | varchar(50) | 编号 | |

### 2. IA_M_HSPOINT (横断面点表)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| hecd | varchar(255) | 横断面编码(关联) |
| pcode | varchar(255) | 点代码/名称 |
| cdistance | double | 累计距离 |
| ele | double | 高程 |
| lgtd | double | 经度 |
| lttd | double | 纬度 |
| coeff | double | 系数 |
| moditime | varchar(255) | 修改时间 |
| orderNo | int(11) | 排序号 |

### 3. IA_M_VSURFACE (纵断面表)
| 字段名 | 类型 | 说明 | 主键/唯一键 |
|--------|------|------|------------|
| vecd | varchar(25) | 纵断面编码 | PRI |
| aid | int(11) | - | |
| channel | varchar(20) | 河流名 | |
| address | varchar(255) | 地址/名称 | |
| isctown | int(11) | - | |
| cele | double(255,0) | 中心点高程 | |
| clgtd | double(255,0) | 中心点经度 | |
| clttd | double(255,0) | 中心点纬度 | |
| eletype | varchar(25) | 高程类型 | |
| method | varchar(25) | 方法 | |
| status | int(11) | 状态 | |
| moditime | datetime | 修改时间 | |
| sele | double | 起点高程 | |
| slgtd | double | 起点经度 | |
| elttd | double | 起点纬度 | |
| adcd | varchar(20) | **防治对象代码** | |
| wscd | varchar(25) | - | |
| folder_name | varchar(255) | 文件夹名称 | UNI |
| number | varchar(25) | 编号 | |

### 4. IA_M_VSPOINT (纵断面点表)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| vecd | varchar(255) | 纵断面编码(关联) |
| pname | varchar(255) | 点名称 |
| cdistance | double | 累计距离 |
| channel | varchar(255) | 河流名 |
| bele | double | 河底高程 |
| ele | double | 高程 |
| lgtd | double | 经度 |
| lttd | double | 纬度 |
| cltype | varchar(255) | 测量类型 |
| moditime | varchar(255) | 修改时间 |
| orderNo | int(11) | 排序号 |

---

## 二、Shapefile字段结构

### 1. 横断面点.shp (20385个点)
| 序号 | 字段名 | 类型 | 示例数据 |
|------|--------|------|----------|
| 0 | hecd | String | undefineAGBKX |
| 1 | pcode | String | 左基点 |
| 2 | cdistance | Real | 0.0 |
| 3 | ele | Real | 829.261 |
| 4 | lgtd | Real | 80.561949 |
| 5 | lttd | Real | 44.260076 |
| 6 | coeff | Real | 0.021 |
| 7 | orderNo | Integer64 | 1 |
| 8 | 名称 | String | 61团巩台沟CS004 |
| 9 | 编号 | String | AJF110071kC00000ZBCS004 |
| 10 | 河流名 | String | 巩台沟 |
| 11 | 类别 | String | A |

### 2. 横断面线.shp (335条线)
| 序号 | 字段名 | 类型 | 示例数据 |
|------|--------|------|----------|
| 0 | NAME | String | 61团巩台沟CS004 |
| 1 | NUMBER | String | AJF110071kC00000ZBCS004 |
| 2 | NAME_1 | String | 巩台沟 |
| 3 | RIVER | String | AJF110071kC00000Z |
| 4 | TYPE | String | A |
| 5 | REMARK | String | 61团巩台沟1号桥 |

### 3. 纵断面点.shp (2680个点)
| 序号 | 字段名 | 类型 | 示例数据 |
|------|--------|------|----------|
| 0 | vecd | String | undefineAYEEG |
| 1 | pname | String | 河底 |
| 2 | cdistance | Real | 0.0 |
| 3 | channel | String | None |
| 4 | bele | Real | 918.213 |
| 5 | lgtd | Real | 80.513471 |
| 6 | lttd | Real | 44.277635 |
| 7 | orderNo | Integer64 | 1 |
| 8 | 名称 | String | 61团开根沟CS021 |
| 9 | 编号 | String | AJF110081kCG0000ZACS021 |
| 10 | 河流名 | String | 开根沟 |
| 11 | 类别 | String | A |

### 4. 纵断面线.shp (30条线)
| 序号 | 字段名 | 类型 | 示例数据 |
|------|--------|------|----------|
| 0 | NAME | String | 61团开根沟CS021 |
| 1 | NUMBER | String | AJF110081kCG0000ZACS021 |
| 2 | NAME_1 | String | 开根沟 |
| 3 | RIVER | String | AJF110081kCG0000Z |
| 4 | TYPE | String | A |
| 5 | REMARK | String | 61团开根沟2号桥纵 |

### 5. 防治对象分布面_合并.shp (42个面)
| 序号 | 字段名 | 类型 | 示例数据 |
|------|--------|------|----------|
| 0 | 名称 | String | 61团六连居民区 |
| 1 | 代码 | String | 661461206001000 |
| 2 | 人口 | Integer64 | 131 |
| 3 | 河流名称 | String | 开根沟 |
| 4 | 河流代码 | String | AJF110081kCG0000Z |
| 5 | 类别 | String | 集镇 |

---

## 三、字段映射关系建议

### A. 横断面点 → IA_M_HSPOINT

| Shapefile字段 | 数据库字段 | 说明 | 需要确认 |
|--------------|-----------|------|---------|
| hecd | hecd | 横断面编码 | ✓ 直接映射 |
| pcode | pcode | 点代码 | ✓ 直接映射 |
| cdistance | cdistance | 累计距离 | ✓ 直接映射 |
| ele | ele | 高程 | ✓ 直接映射 |
| lgtd | lgtd | 经度 | ✓ 直接映射 |
| lttd | lttd | 纬度 | ✓ 直接映射 |
| coeff | coeff | 系数 | ✓ 直接映射 |
| orderNo | orderNo | 排序号 | ✓ 直接映射 |
| - | moditime | 修改时间 | **请确认: 设为NULL还是当前时间?** |

### B. 横断面点 → IA_M_HSURFACE (汇总)

| Shapefile字段 | 数据库字段 | 说明 | 需要确认 |
|--------------|-----------|------|---------|
| hecd | hecd | 横断面编码(主键) | ✓ 按hecd分组 |
| 河流名 | channel | 河流名 | ✓ 取第一条记录 |
| 名称 | address | 横断面名称 | ✓ 取第一条记录 |
| 编号 | number | 编号 | **请确认: 从横断面点还是横断面线取?** |
| 类别 | dmidentit | 断面标识 | **请确认: A→0, B→2, 其他?** |
| coeff | coeff | 系数 | ✓ 取第一条记录 |
| - | adcd | 防治对象代码 | **后续通过空间关联更新** |
| - | vecd | 关联纵断面编码 | **后续通过空间关联更新** |

### C. 纵断面点 → IA_M_VSPOINT

| Shapefile字段 | 数据库字段 | 说明 | 需要确认 |
|--------------|-----------|------|---------|
| vecd | vecd | 纵断面编码 | ✓ 直接映射 |
| pname | pname | 点名称 | ✓ 直接映射 |
| cdistance | cdistance | 累计距离 | ✓ 直接映射 |
| channel | channel | 河流名 | **请确认: 很多为None,是否从"河流名"字段取?** |
| bele | bele | 河底高程 | ✓ 直接映射 |
| lgtd | lgtd | 经度 | ✓ 直接映射 |
| lttd | lttd | 纬度 | ✓ 直接映射 |
| orderNo | orderNo | 排序号 | ✓ 直接映射 |
| - | ele | 高程 | **请确认: 是否等于bele?** |
| - | cltype | 测量类型 | **请确认: 设为什么值?** |
| - | moditime | 修改时间 | **请确认: 设为NULL还是当前时间?** |

### D. 纵断面点 → IA_M_VSURFACE (汇总)

| Shapefile字段 | 数据库字段 | 说明 | 需要确认 |
|--------------|-----------|------|---------|
| vecd | vecd | 纵断面编码(主键) | ✓ 按vecd分组 |
| 河流名 | channel | 河流名 | ✓ 取第一条记录 |
| 名称 | address | 纵断面名称 | ✓ 取第一条记录 |
| 编号 | number | 编号 | **请确认: 从纵断面点还是纵断面线取?** |
| lgtd (第一个点) | slgtd | 起点经度 | **请确认: 取orderNo=1的点?** |
| lttd (第一个点) | elttd | 起点纬度 | **请确认: 取orderNo=1的点?** |
| bele (第一个点) | sele | 起点高程 | **请确认: 取orderNo=1的点?** |
| - | cele | 中心点高程 | **请确认: 如何计算?取平均?** |
| - | clgtd | 中心点经度 | **请确认: 如何计算?取中点?** |
| - | clttd | 中心点纬度 | **请确认: 如何计算?取中点?** |
| - | eletype | 高程类型 | **请确认: 设为什么值?** |
| - | method | 方法 | **请确认: 设为什么值?** |
| - | adcd | 防治对象代码 | **后续通过空间关联更新** |

---

## 四、需要用户确认的关键问题

### 1. 编号字段来源
- **问题**: `number`字段应该从**点shapefile的"编号"字段**还是**线shapefile的"NUMBER"字段**获取?
- **横断面**: 点中编号=`AJF110071kC00000ZBCS004`, 线中NUMBER=`AJF110071kC00000ZBCS004` (一致)
- **纵断面**: 点中编号=`AJF110081kCG0000ZACS021`, 线中NUMBER=`AJF110081kCG0000ZACS021` (一致)
- **建议**: 从线shapefile获取更准确

### 2. 纵断面点的channel字段处理
- **问题**: 纵断面点shapefile中`channel`字段很多为None,但有"河流名"字段
- **建议**: 优先使用shapefile的channel字段,如果为None则使用"河流名"字段

### 3. 纵断面VSURFACE表的中心点坐标
- **问题**: `cele/clgtd/clttd`如何计算?
- **选项**: 
  - A. 取所有点的平均值
  - B. 取中间点(orderNo中位数)
  - C. 从纵断面线shapefile计算线的中点
- **请确认**: 选择哪种方式?

### 4. 纵断面VSPOINT的ele字段
- **问题**: 数据库有`ele`字段,但shapefile主要是`bele`(河底高程)
- **建议**: ele = bele

### 5. dmidentit字段映射规则
- **当前规则**: A→'0', B→'2', 其他→None
- **请确认**: 是否正确?

### 6. 时间字段处理
- **问题**: moditime字段设为NULL还是插入时的当前时间?
- **建议**: 设为NULL,等待后续业务更新

### 7. eletype和method字段
- **问题**: 这些字段应该设为什么默认值?
- **请确认**: 提供默认值或设为NULL

### 8. vecd字段更新逻辑
- **问题**: 横断面表中的`vecd`字段存储关联的纵断面编码
- **确认**: 是否通过"横断面线与纵断面线的空间相交"来建立关联关系?

---

## 五、请您审核并提供以下信息

请您针对上述8个问题提供明确的答案,我将根据您的确认修改脚本代码。

格式示例:
```
1. 编号字段来源: 从线shapefile获取
2. channel字段处理: 优先channel,为None时使用"河流名"
3. 中心点坐标计算: 选项A-取平均值
4. ele字段: ele = bele
5. dmidentit映射: A→'0', B→'2', 其他→None (正确)
6. moditime: 设为NULL
7. eletype和method: 设为NULL
8. vecd关联: 通过横断面线与纵断面线相交建立
```
